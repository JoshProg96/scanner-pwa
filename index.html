<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>QR Scanner</title>

<!-- FIX 1: Pakai versi stabil -->
<script src="https://unpkg.com/html5-qrcode@2.3.8"></script>

<style>
body { font-family: Arial; padding:20px; }
#reader { width:100%; max-width:350px; margin:auto; }
#status { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>QR Scanner</h2>

<div id="reader"></div>
<div id="status">Loading camera…</div>

<script>
/* Update count */
function updateCount() {
  const items = JSON.parse(localStorage.getItem("scanned") || "[]");
  document.getElementById("status").textContent =
    "Stored: " + items.length + " data";
}

/* Save result */
function handleResult(qr) {
  const items = JSON.parse(localStorage.getItem("scanned") || "[]");
  items.push({ data: qr, time: new Date().toISOString() });
  localStorage.setItem("scanned", JSON.stringify(items));
  updateCount();
}

/* Start scanner */
async function start() {
  try {
    const html5QrCode = new Html5Qrcode("reader");

    const cameras = await Html5Qrcode.getCameras();
    if (!cameras || cameras.length === 0) {
      throw new Error("No camera found");
    }

    const cameraId = cameras[cameras.length - 1].id;

    await html5QrCode.start(
      cameraId,
      { fps: 10, qrbox: 250 },
      qr => handleResult(qr)
    );

    document.getElementById("status").textContent =
      "Camera ready — point to a QR";
    updateCount();

  } catch (e) {
    document.getElementById("status").textContent =
      "Camera error: " + (e.message || e);
  }
}

/* FIX 2: Ganti dari window.onload ke DOMContentLoaded */
document.addEventListener("DOMContentLoaded", start);
</script>

</body>
</html>
